import{Pool as t}from"undici";function e(t,e){var i={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(i[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(t);r<n.length;r++)e.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(t,n[r])&&(i[n[r]]=t[n[r]])}return i}function i(t,e,i,n){return new(i||(i=Promise))((function(r,s){function o(t){try{h(n.next(t))}catch(t){s(t)}}function a(t){try{h(n.throw(t))}catch(t){s(t)}}function h(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))}class n{constructor(e){this.options=e;const{url:i,user:n,password:r,connections:s=10}=this.options,o="Basic "+Buffer.from(n+":"+r).toString("base64");this.headers={"Content-type":"application/json",Authorization:o},this.client=new t(i,{connections:s})}request(t){return i(this,void 0,void 0,(function*(){const{headers:e}=this,{headers:i={},Method:n}=t,r=Object.assign(e,i);t.headers=r;const{body:s,statusCode:o}=yield this.client.request(t);if("HEAD"==n||"GET"===n)return 200===o;{const t=yield s.json();return 200!==o?new Error(null==t?void 0:t.error.toString()):t}}))}}class r{constructor(t){this.client=t}list(t){return this.client.request({path:"/api/index",method:"GET",query:t})}create(t){return this.client.request({path:"/api/index",method:"POST",body:JSON.stringify(t)})}exists(t){return this.client.request({path:`/api/index/${t.index}`,method:"HEAD"})}get(t){return this.client.request({path:`/api/index/${t}`,method:"GET"})}delete(t){return this.client.request({path:`/api/index/${t}`,method:"DELETE"})}refresh(t){return this.client.request({path:`/api/index/${t}/refresh`,method:"POST"})}getMapping(t){return this.client.request({path:`/api/${t}/_mapping`,method:"GET"})}updateMapping({index:t,mapping:e}){return this.client.request({path:`/api/${t}/_mapping`,method:"PUT",body:JSON.stringify(e)})}getSetting(t){return this.client.request({path:`/api/${t}/_setting`,method:"GET"})}updateSetting({index:t,setting:e}){return this.client.request({path:`/api/${t}/_setting`,method:"PUT",body:JSON.stringify(e)})}}class s{constructor(t){this.client=t}multi(t){const{index:e,data:i}=t;return this.client.request({path:`/api/${e}/_multi`,method:"POST",body:JSON.stringify(i)})}bulkv2(t){const{index:e,data:i}=t;return this.client.request({path:"/api/_bulkv2",method:"POST",body:JSON.stringify({index:e,records:i})})}create(t){const{index:e,data:i}=t;return this.client.request({path:`/api/${e}/_doc/`,method:"POST",body:JSON.stringify(i)})}update(t){const{index:e,data:i,id:n}=t;return this.client.request({path:`/api/${e}/_update/${n}`,method:"POST",body:JSON.stringify(i)})}createOrUpdate(t){const{index:e,data:i,id:n}=t;return this.client.request({path:`/api/${e}/_doc/${n}`,method:"PUT",body:JSON.stringify(i)})}delete(t){const{index:e,id:i}=t;return this.client.request({path:`/api/${e}/_update/${i}`,method:"DELETE"})}}class o{constructor(t){this.client=t}search(t){const{index:i}=t,n=e(t,["index"]);return this.client.request({path:`/api/${i}/_search`,method:"POST",body:JSON.stringify(n)})}esSearch(t){const{index:i}=t,n=e(t,["index"]);return this.client.request({path:`/es/${i}/_search`,method:"POST",body:JSON.stringify(n)})}}class a{constructor(t){const{url:e,user:i,password:a}=t,h=new n({url:e,user:i,password:a});this.indices=new r(h),this.document=new s(h),this.search=new o(h),this.client=h}healthz(){return this.client.request({path:"/healthz",method:"GET"})}version(){return this.client.request({path:"/version",method:"GET"})}}export{a as default};
